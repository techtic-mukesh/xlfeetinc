{{ 'component-cart.css' | asset_url | stylesheet_tag }}
{{ 'component-cart-items.css' | asset_url | stylesheet_tag }}
{{ 'component-totals.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-discounts.css' | asset_url | stylesheet_tag }}
{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{%- unless settings.cart_type == 'drawer' -%}
  <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
{%- endunless -%}

<script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>

<cart-items class="gradient color-{{ section.settings.color_scheme }} isolate{% if cart == empty %} is-empty{% else %} section-{{ section.id }}-padding{% endif %}">
  <div class="page-width">
    <div class="title-wrapper-with-link">
      <h1 class="title title--primary">SHOPPING BAG</h1>
      <a href="{{ routes.all_products_collection_url }}" class="underlined-link">
        {{- 'general.continue_shopping' | t -}}
      </a>
    </div>

    <div class="cart__warnings">
      <h1 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h1>
      <a href="{{ routes.all_products_collection_url }}" class="button">
        {{ 'general.continue_shopping' | t }}
      </a>

      {%- if shop.customer_accounts_enabled and customer == null -%}
        <h2 class="cart__login-title">{{ 'sections.cart.login.title' | t }}</h2>
        <p class="cart__login-paragraph">
          {{ 'sections.cart.login.paragraph_html' | t: link: routes.account_login_url }}
        </p>
      {%- endif -%}
    </div>

    <form action="{{ routes.cart_url }}" class="cart__contents critical-hidden" method="post" id="cart">
      <div class="cart__items" id="main-cart-items" data-id="{{ section.id }}">
        <div class="js-contents">
          {%- if cart != empty -%}
            <table class="cart-items cart-items--custom">
              <caption class="visually-hidden">
                {{ 'sections.cart.title' | t }}
              </caption>
              <thead>
                <tr>
                  <th class="caption-with-letter-spacing" colspan="2" scope="col">Item</th>
                  <th class="price-col small-hide  caption-with-letter-spacing" scope="col">Price</th>
                  <th class="medium-hide large-up-hide  caption-with-letter-spacing" scope="col">{{ 'sections.cart.headings.total' | t }}</th>
                  <th class="qty-col cart-items__heading--quantity small-hide caption-with-letter-spacing" scope="col">Qty</th>
                  <th class="subtotal-col small-hide  caption-with-letter-spacing" scope="col">Subtotal</th>
                </tr>
              </thead>

              <tbody>
                {%- for item in cart.items -%}
                  <tr
                    class="cart-item {% if item.parent_relationship.parent != null %}cart-item__nested-line{% endif %}"
                    id="CartItem-{{ item.index | plus: 1 }}"
                    {% if item.parent_relationship.parent != null %}
                      aria-label="{{- 'products.product.nested_label' | t: title: item.product.title, parent_title: item.parent_relationship.parent.title | escape -}}"
                    {% endif %}
                  >
                    <td class="cart-item__media">
                      {% if item.image %}
                        <a href="{{ item.url }}" class="cart-item__link" aria-hidden="true" tabindex="-1"> </a>
                        <div class="cart-item__image-container global-media-settings cart-item__image--rounded">
                          <img
                            src="{{ item.image | image_url: width: 300 }}"
                            class="cart-item__image"
                            alt="{{ item.image.alt | escape }}"
                            loading="lazy"
                            width="150"
                            height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                          >
                        </div>
                      {% endif %}
                    </td>

                    <td class="cart-item__details">
                      {%- if settings.show_vendor -%}
                        <p class="caption-with-letter-spacing meta">{{ item.product.vendor }}</p>
                      {%- endif -%}

                      <a href="{{ item.url }}" class="cart-item__name h4 break">{{ item.product.title | escape }}</a>

                      {%- if item.product.has_only_default_variant == false -%}
                        <div class="meta-line">
                          {%- for option in item.options_with_values -%}
                            <span class="meta">{{ option.name }} : {{ option.value }}</span>{% unless forloop.last %}<span class="meta-dot">•</span>{% endunless %}
                          {%- endfor -%}
                        </div>
                      {%- endif -%}

                      {%- if item.sku or item.variant.sku -%}
                        <div class="meta-line">
                          <span class="meta">SKU : {{ item.sku | default: item.variant.sku }}</span>
                        </div>
                      {%- endif -%}

                      <ul class="discounts list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                        {%- for discount in item.line_level_discount_allocations -%}
                          <li class="discounts__discount">
                            {{- 'icon-discount.svg' | inline_asset_content -}}
                            {{ discount.discount_application.title | escape }}
                          </li>
                        {%- endfor -%}
                      </ul>
                    </td>

                    <!-- Desktop PRICE -->
                    <td class="cart-item__price small-hide right">
                      <div class="price price--end">
                        {{ item.final_price | money }}
                      </div>
                    </td>

                    <!-- Mobile TOTAL -->
                    <td class="cart-item__totals medium-hide large-up-hide">
                      {%- render 'loading-spinner' -%}
                      <div class="cart-item__price-wrapper">
                        <span class="price price--end">{{ item.final_line_price | money }}</span>
                      </div>
                    </td>

                    {%- liquid
                      assign has_qty_rules = false
                      if item.variant.quantity_rule.increment > 1 or item.variant.quantity_rule.min > 1 or item.variant.quantity_rule.max != null
                        assign has_qty_rules = true
                      endif

                      assign has_vol_pricing = false
                      if item.variant.quantity_price_breaks.size > 0
                        assign has_vol_pricing = true
                      endif
                    -%}
                    <td class="cart-item__quantity{% if has_qty_rules or has_vol_pricing %} cart-item__quantity--info{% endif %}">
                      <quantity-popover>
                        <div class="cart-item__quantity-wrapper quantity-popover-wrapper">
                          <label class="visually-hidden" for="Quantity-{{ item.index | plus: 1 }}">
                            {{ 'products.product.quantity.label' | t }}
                          </label>
                          <div class="quantity-popover-container{% if has_qty_rules or has_vol_pricing %} quantity-popover-container--hover{% endif %}">
                            {%- if has_qty_rules or has_vol_pricing -%}
                              <button type="button" aria-expanded="false" class="quantity-popover__info-button quantity-popover__info-button--icon-only button button--tertiary small-hide medium-hide">
                                {{- 'icon-info.svg' | inline_asset_content -}}
                              </button>
                            {%- endif -%}
                            <quantity-input class="quantity cart-quantity quantity--pill">
                              {% assign can_update_quantity = item.instructions.can_update_quantity | default: true %}
                              <button class="quantity__button" name="minus" type="button" {% if can_update_quantity == false %}disabled{% endif %}>
                                <span class="visually-hidden">{{- 'products.product.quantity.decrease' | t: product: item.product.title | escape -}}</span>
                                <span class="svg-wrapper">{{- 'icon-minus.svg' | inline_asset_content -}}</span>
                              </button>
                              <input
                                class="quantity__input"
                                data-quantity-variant-id="{{ item.variant.id }}"
                                type="number"
                                name="updates[]"
                                value="{{ item.quantity }}"
                                data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}
"
                                min="0"
                                data-min="{{ item.variant.quantity_rule.min }}"
                                {% if item.variant.quantity_rule.max != null %}max="{{ item.variant.quantity_rule.max }}"{% endif %}
                                step="{{ item.variant.quantity_rule.increment }}"
                                aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                id="Quantity-{{ item.index | plus: 1 }}"
                                data-index="{{ item.index | plus: 1 }}"
                                {% if can_update_quantity == false %}disabled{% endif %}
                              >
                              <button class="quantity__button" name="plus" type="button" {% if can_update_quantity == false %}disabled{% endif %}>
                                <span class="visually-hidden">{{- 'products.product.quantity.increase' | t: product: item.product.title | escape -}}</span>
                                <span class="svg-wrapper">{{- 'icon-plus.svg' | inline_asset_content -}}</span>
                              </button>
                            </quantity-input>
                          </div>
                        </div>
                        <div class="cart-item__error" id="Line-item-error-{{ item.index | plus: 1 }}" role="alert">
                          <small class="cart-item__error-text"></small>
                          <span class="svg-wrapper">{{- 'icon-error.svg' | inline_asset_content -}}</span>
                        </div>
                      </quantity-popover>
                    </td>

                    <!-- Desktop SUBTOTAL + actions -->
                    <td class="cart-item__totals small-hide">
                      {%- render 'loading-spinner' -%}
                      <div class="cart-item__price-wrapper">
                        <span class="price price--end">{{ item.final_line_price | money }}</span>
                        <div class="line-actions">
                          <a class="line-action" href="{{ item.url }}" aria-label="Edit item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41L18.37 3.29a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="currentColor"/>
                            </svg>
                          </a>
                          <a class="line-action" href="{{ item.url_to_remove }}" aria-label="{{ 'sections.cart.remove_title' | t: title: item.title | escape }}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                              <path d="M6 7h12M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2m-9 0v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V7H6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </a>
                        </div>
                      </div>
                    </td>
                  </tr>
                {%- endfor -%}
              </tbody>
            </table>
          {%- endif -%}
        </div>
      </div>

      <p class="visually-hidden" id="cart-live-region-text" aria-live="polite" role="status"></p>
      <p class="visually-hidden" id="shopping-cart-line-item-status" aria-live="polite" aria-hidden="true" role="status">
        {{ 'accessibility.loading' | t }}
      </p>
    </form>
  </div>
</cart-items>

<style>
/* Your global cart table tweaks (scoped to avoid conflicts) */
.cart-items--custom .title-wrapper-with-link { margin-top: 0; }

/* Reset paddings/borders for a clean grid */
.cart-items--custom td,
.cart-items--custom th { padding: 0; border: none; }
.cart-items--custom thead th {
  text-transform: uppercase;
  text-align: left;
  padding-bottom: 1.8rem;
  opacity: .85;
  font-weight: normal;
}

/* Align helpers */
.cart-item__quantity-wrapper { display: flex; }
.cart-item__totals { position: relative; }

/* Media + image */
.cart-item__image-container { display: inline-flex; align-items: flex-start; }
.cart-item__image-container:after { content: none; }
.cart-item__image { height: auto; max-width: calc(10rem / var(--font-body-scale)); }
@media screen and (min-width: 750px) { .cart-item__image { max-width: 100%; } }
.cart-item__image--rounded { border-radius: 10px; background: #f7f7f7; overflow: hidden; }

/* Details/meta */
.cart-item__details { font-size: 1.6rem; line-height: calc(1 + 0.4 / var(--font-body-scale)); }
.cart-item__details > * { margin: 0; max-width: 30rem; }
.cart-item__details > * + * { margin-top: .6rem; }
.cart-item__name { text-decoration: none; display: block; }
.cart-item__name:hover { text-decoration: underline; text-underline-offset: .3rem; text-decoration-thickness: .2rem; }
.meta-line { margin-top: 0;     line-height: normal; }
.meta { font-size: 12px; color: #666; }
.meta-dot { margin: 0 6px; color: #c7c7c7; }

/* Prices block */
.cart-item__price-wrapper > * { display: block; margin: 0; padding: 0; }
.cart-item__discounted-prices dd { margin: 0; }
.cart-item__discounted-prices .cart-item__old-price { font-size: 1.4rem; }
.cart-item__old-price { opacity: .7; }
.cart-item__final-price { font-weight: 400; }
.product-option { font-size: 1.4rem; word-break: break-word; line-height: calc(1 + 0.5 / var(--font-body-scale)); }
.product-option + .product-option { margin-top: .4rem; }
.product-option * { display: inline; margin: 0; }

/* Remove button baseline */
cart-remove-button .button { min-width: calc(4.5rem / var(--font-body-scale)); min-height: 4.5rem; padding: 0; margin: 0 .1rem .1rem 0; }
cart-remove-button .button:before, cart-remove-button .button:after { content: none; }
@media screen and (min-width: 750px) { cart-remove-button .button { min-width: 3.5rem; min-height: 3.5rem; } }
cart-remove-button .icon-remove { height: 1.5rem; width: 1.5rem; }

/* Loaders + errors */
.cart-item .loading__spinner { top: 0; left: auto; right: auto; bottom: 0; padding: 0; }
@media screen and (min-width: 750px) { .cart-item .loading__spinner { right: 0; padding-top: 4.5rem; bottom: auto; } }
.cart-item .loading__spinner:not(.hidden) ~ * { visibility: hidden; }
.cart-item__error { display: flex; align-items: flex-start; margin-top: .2rem; width: min-content; min-width: 100%; }
.cart-item__error-text { font-size: 1.3rem; line-height: 1.4; letter-spacing: .04rem; order: 1; }
.cart-item__error-text + .svg-wrapper { flex-shrink: 0; width: 1.5rem; height: 1.5rem; margin-right: .7rem; margin-top: .25rem; }
.cart-item__error-text:empty + .svg-wrapper { display: none; }

/* Desktop table structure and spacing */
@media screen and (min-width: 750px) {
  .cart-items--custom { border-spacing: 0; border-collapse: separate; box-shadow: none; width: 100%; display: table; }
  .cart-items--custom td { vertical-align: top; padding-top: 0; }
  .cart-item { display: table-row; }
  .cart-item > td + td { padding-left: 0; }
  .cart-item .cart-item__quantity{
    padding-left:0;
  }
}
.cart-items--custom td.cart-item__price .price--end{
  text-align:center;
}
/* Column widths (desktop) */
.cart-items--custom { table-layout: fixed; }

/* Title */
.title.title--primary { font-size: 28px; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; font-family: "HelveticaNeue-BlackExt"; }

/* Quantity pill */
.quantity--pill { border: 1px solid #e5e5e5; border-radius: 24px; padding: 2px; display: inline-flex; }
.quantity--pill .quantity__input { width: 44px; text-align: center; }
.cart-item__quantity-wrapper { justify-content: center; }

/* Subtotal actions (edit/remove) */
.line-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px; }
.line-action {     
    color: #231F20;
    display: inline-flex;
    /* padding: 6px; */
    border-radius: 6px;
    width: 22px;
    height: 22px;
    justify-content: center;
    text-align: center;
    align-items: center;  }
.line-action:hover { color: #111; border-color: rgba(0,0,0,.25); }

/* Mobile keeps Dawn behavior */
@media screen and (max-width: 749px) {
  .cart-items,
  .cart-items thead,
  .cart-items tbody { display: block; width: 100%; }

  .cart-items thead tr {
    display: flex; justify-content: space-between;
    gap:16px;
    border-bottom: .1rem solid rgba(var(--color-foreground), .2);
    margin-bottom: 4rem;
  }

  .cart-item {
    display: grid;
    grid-template: repeat(2, auto) / repeat(4, 1fr);
    gap: 1.5rem;
    margin-bottom: 3.5rem;
  }

  .cart-item__media { grid-row: 1 / 3; }
  .cart-item__details { grid-column: 2 / 4; }
  .cart-item__quantity { grid-column: 2 / 5; }
  .cart-item__totals { display: flex; align-items: flex-start; justify-content: flex-end; }
}

/* ======================================================
   FINAL GRID ALIGNMENT FIX – HEADER + ROW SYNC
====================================================== */
.cart-items thead th{
    color: #231F20;
    font-size: 16px;
    font-weight: 500;
    text-transform: capitalize;
        opacity: 1;
}
.is-cart-page{
  display:flex;
}
.is-cart-empty{
  display:block;
}
.is-cart-empty .cart__items-wrapper{
      max-width: 100%;
}
.cart-item__quantity .quantity:after{
  box-shadow:unset;
}
.cart__items-wrapper .cart-item__details .cart-item__name{
      margin: 0 0 13px;
}
.cart__items-wrapper  .quantity--pill{
      width: 82px;
          min-height: 27px;
}
.cart__items-wrapper  .quantity__button ,.cart__items-wrapper .quantity--pill .quantity__input{
  width:27px;
}
@media screen and (min-width: 750px) {

  /* Define ONE grid for header + rows */
  :root {
    --cart-grid: 110px 1fr 140px 140px 140px;
  }

  /* TABLE RESET */
  .cart-items {
    display: block !important;
  }

  .cart-items thead,
  .cart-items tbody {
    display: block;
  }

  /* HEADER */
  .cart-items thead tr {
    display: flex !important;
    align-items: center;
    padding-bottom: 16px;
    border-bottom: 1px solid #e5e5e5;
    gap:16px;
  }
.cart-items thead th:first-child{
      width: 55%;
}
th.price-col.small-hide.right.caption-with-letter-spacing {
    width: 10%;
}
th.qty-col.cart-items__heading--quantity.small-hide.caption-with-letter-spacing {
    width: 20%;
    text-align:center;
}
th.subtotal-col.small-hide.right.caption-with-letter-spacing {
    width: 10%;
}
  .cart-items thead th {
    padding: 0 !important;
  }
  .cart-items tbody tr.cart-item{
    display:flex;
  }
td.cart-item__media{
  width:10%;
}
td.cart-item__details{
    width: 45%;
}
.cart-items--custom th.price-col, .cart-items--custom td.cart-item__price{
  width: 10%;
  text-align:center;
}
td.cart-item__quantity{
    width: 20%;
}
td.cart-item__totals.right.small-hide{
  width: 10%;
}
  /* Quantity pill */
  .cart-item__quantity-wrapper {
    justify-content: center;
  }

  /* Subtotal + icons stack */
  .cart-item__price-wrapper {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
td.cart-item__totals.small-hide{
    height: -webkit-fill-available;
    display: flex;
}
.cart-item__quantity-wrapper .quantity-popover-container{
  padding:0;
}
  .line-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
  }
}
@media screen and (max-width: 1024px) {
.cart-item__details .cart-item__name{
  font-size: 12px;
}
quantity-input.quantity.cart-quantity.quantity--pill {
    width: 80px;
    height: 40px;
    min-height: unset;
}
.cart-item__quantity-wrapper button.quantity__button {
    width: 15px;
}
.cart-items--custom td.cart-item__price .price--end{
  font-size:12px;
}
}
@media screen and (max-width: 750px) {
  .cart__footer-wrapper , .cart__items-wrapper {
    max-width: 100%;
    display: block;
    width: 100%;
}
.is-cart-page {
    display: block;
}
}
</style>

{% schema %}
{
  "name": "t:sections.main-cart-items.name",
  "class": "cart__items-wrapper",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}