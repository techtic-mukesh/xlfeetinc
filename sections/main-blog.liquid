{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .blog--center h1 { 
    text-align: center;
    font-size: 37px;
    font-weight: 500;
    margin-bottom: 50px;
  }
  .blog--left h1 { text-align: left; }

  .blog-articles {
    display: grid;
    grid-template-columns: repeat(var(--cols-mobile, 1), 1fr);
    gap: 20px;
  }
  @media screen and (min-width: 750px) {
    .blog-articles {
      grid-template-columns: repeat(var(--cols-desktop, 3), 1fr);
    }
  }


  .blog-articles__article img {
    width: 100%;
    display: block;
  }


.button.article-read-more:after , 
.button.article-read-more:not([disabled]):hover:after{
  box-shadow:unset;
}

  .article-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: #111;
    color: #fff;
    font-size: 12px;
    line-height: 1;
    padding: 6px 10px;
    border-radius: 999px;
    z-index: 2;
  }

  .blog-load-more { text-align: center; margin-top: 50px; }
  .blog-load-more .button.is-loading { opacity: .6; pointer-events: none; }
  .blog-load-more button{
    border: 1px solid {{ section.settings.heading_color }};
    color:{{ section.settings.heading_color }};
    font-size: 16px;
    font-weight: 500;
    letter-spacing: 0;
    min-height: 50px;
    max-width: 164px;
    width: 100%;
  }
  .blog-load-more button:after , .blog-load-more .button:not([disabled]):hover:after{
    box-shadow:unset;
  }
  .main_blog_heading , .article-read-more{
    color:{{ section.settings.heading_color }};
  }
  .article-card__excerpt{
    color:{{section.settings.article_card_content_color }};
  }
  @media screen and (max-width: 990px) {
    .blog--center h1{
      font-size: 25px;
      line-height: normal;
      margin-bottom: 30px;
    }
    .blog-articles .card.article-card .card__inner{
      height:unset;
    }
  }
    @media screen and (max-width: 749px) {
    .blog-load-more { margin-top: 20px; }
  }
{%- endstyle -%}

{%- paginate blog.articles by section.settings.items_per_load -%}
  <div 
    id="BlogSection-{{ section.id }}"
    class="main-blog page-width section-{{ section.id }}-padding blog--{{ section.settings.title_align }}{% if section.settings.card_shadow %} has-shadow{% endif %} color-{{ section.settings.color_scheme}}"
    data-section-id="{{ section.id }}"
    style="--cols-desktop: {{ section.settings.columns_desktop }}; --cols-mobile: {{ section.settings.columns_mobile }}; --card-radius: {{ section.settings.card_radius }}px;"
  >
    <h1 class="main_blog_heading title--primary{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
      {%- if section.settings.custom_heading != blank -%}
        {{ section.settings.custom_heading | escape }}
      {%- else -%}
        {{ blog.title | escape }}
      {%- endif -%}
    </h1>

    <div class="blog-articles {% if section.settings.layout == 'collage' %}blog-articles--collage{% endif %}">
      {%- for article in blog.articles -%}
        <div
          class="blog-articles__article article{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
          {% if settings.animations_reveal_on_scroll %}data-cascade style="--animation-order: {{ forloop.index }};"{% endif %}
        >
          {%- if section.settings.show_tag_badge and article.tags.size > 0 -%}
            <span class="article-badge">{{ article.tags.first }}</span>
          {%- endif -%}

          {%- render 'article-card',
            article: article,
            media_height: section.settings.image_height,
            media_aspect_ratio: article.image.aspect_ratio,
            show_image: section.settings.show_image,
            show_date: section.settings.show_date,
            show_author: section.settings.show_author,
            show_excerpt: true
          -%}

          {%- if section.settings.show_custom_read_more -%}
            <a class="article-read-more button" href="{{ article.url }}" aria-label="{{ article.title | escape }}">
              {{ section.settings.read_more_label }}
              <span aria-hidden="true">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6.41602 15.5833L15.5827 6.41663M15.5827 6.41663H7.33268M15.5827 6.41663V14.6666" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </a>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>

    {%- if paginate.next -%}
      <div class="blog-load-more">
        <button
          type="button"
          class="button button--secondary"
          data-load-more
          aria-label="{{ section.settings.load_more_label | escape }}"
          data-next-url="{{ paginate.next.url | escape }}"
        >
          {{ section.settings.load_more_label }}
        </button>
      </div>
    {%- endif -%}
  </div>
{%- endpaginate -%}

<script>
  (function() {
    var section = document.getElementById('BlogSection-{{ section.id }}');
    if (!section) return;

    var list = section.querySelector('.blog-articles');
    var button = section.querySelector('[data-load-more]');
    if (!list || !button) return;

    button.addEventListener('click', function() {
      var rawUrl = button.dataset.nextUrl;
      if (!rawUrl) return;

      var url = rawUrl + (rawUrl.indexOf('?') > -1 ? '&' : '?') + 'section_id={{ section.id }}';
      button.classList.add('is-loading');
      button.disabled = true;

      fetch(url)
        .then(function(res) { return res.text(); })
        .then(function(html) {
          var doc = new DOMParser().parseFromString(html, 'text/html');
          var nextSection = doc.getElementById('BlogSection-{{ section.id }}');
          if (!nextSection) throw new Error('Section not found in response');

          var newCards = nextSection.querySelectorAll('.blog-articles__article');
          newCards.forEach(function(card) { list.appendChild(card); });

          var nextBtn = nextSection.querySelector('[data-load-more]');
          if (nextBtn && nextBtn.dataset.nextUrl) {
            button.dataset.nextUrl = nextBtn.dataset.nextUrl;
            button.classList.remove('is-loading');
            button.disabled = false;
          } else {
            button.remove();
          }
        })
        .catch(function() {
          button.classList.remove('is-loading');
          button.disabled = false;
        });
    });
  })();
</script>

{% schema %}
{
  "name": "t:sections.main-blog.name",
  "tag": "section",
  "class": "section",
  "settings": [
     {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Section Color Scheme",
      "default": "background-1"
    },
    { "type": "select", "id": "layout", "options": [
      { "value": "grid", "label": "t:sections.main-blog.settings.layout.options__1.label" },
      { "value": "collage", "label": "t:sections.main-blog.settings.layout.options__2.label" }
    ], "default": "grid", "label": "t:sections.main-blog.settings.layout.label" },

    { "type": "text", "id": "custom_heading", "label": "Custom heading (optional)" },
    {
      "type":"color",
      "id":"heading_color",
      "label":"Heading Color"
    },
    {
      "type":"color",
      "id":"article_card_content_color",
      "label":"Article Card Content Color"
    },
    { "type": "select", "id": "title_align", "label": "Heading alignment", "options": [
      { "value": "center", "label": "Center" },
      { "value": "left", "label": "Left" }
    ], "default": "center" },

    { "type": "checkbox", "id": "show_image", "default": true, "label": "t:sections.main-blog.settings.show_image.label" },
    { "type": "select", "id": "image_height", "options": [
      { "value": "adapt", "label": "t:sections.main-blog.settings.image_height.options__1.label" },
      { "value": "small", "label": "t:sections.main-blog.settings.image_height.options__2.label" },
      { "value": "medium", "label": "t:sections.main-blog.settings.image_height.options__3.label" },
      { "value": "large", "label": "t:sections.main-blog.settings.image_height.options__4.label" }
    ], "default": "medium", "label": "t:sections.main-blog.settings.image_height.label" },
    { "type": "checkbox", "id": "show_date", "default": true, "label": "t:sections.main-blog.settings.show_date.label" },
    { "type": "checkbox", "id": "show_author", "default": false, "label": "t:sections.main-blog.settings.show_author.label" },

    { "type": "range", "id": "items_per_load", "min": 1, "max": 24, "step": 1, "label": "Articles per load", "default": 6 },

    { "type": "range", "id": "columns_desktop", "min": 2, "max": 4, "step": 1, "label": "Columns (desktop)", "default": 3 },
   {
    "type": "select",
    "id": "columns_mobile",
    "label": "Columns (mobile)",
    "default": "1",
    "options": [
      { "value": "1", "label": "1" },
      { "value": "2", "label": "2" }
    ]
  },

    { "type": "checkbox", "id": "show_custom_read_more", "label": "Show custom READ MORE button", "default": true },
    { "type": "text", "id": "read_more_label", "label": "Read more label", "default": "READ MORE" },

    { "type": "checkbox", "id": "show_tag_badge", "label": "Show first tag badge", "default": false },

    { "type": "text", "id": "load_more_label", "label": "Load more button label", "default": "LOAD MORE" },

    { "type": "header", "content": "t:sections.all.padding.section_padding_heading" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "t:sections.all.padding.padding_top", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "t:sections.all.padding.padding_bottom", "default": 36 }
  ]
}
{% endschema %}